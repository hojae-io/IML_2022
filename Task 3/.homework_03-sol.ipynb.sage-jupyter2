{"backend_state":"init","kernel":"python3","kernel_state":"idle","kernel_usage":{"cpu":0,"memory":0},"metadata":{"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.8.6"}},"trust":false,"type":"settings"}
{"cell_type":"code","exec_count":1,"id":"3f643a","input":"#Import the AG news dataset (same as hw01)\n#Download them from here \n#!wget https://raw.githubusercontent.com/mhjabreel/CharCnn_Keras/master/data/ag_news_csv/train.csv\nimport warnings\nwarnings.filterwarnings('ignore')\n\n\nimport pandas as pd\nimport nltk\ndf = pd.read_csv('train.csv')\n\ndf.columns = [\"label\", \"title\", \"lead\"]\nlabel_map = {1:\"world\", 2:\"sport\", 3:\"business\", 4:\"sci/tech\"}\ndef replace_label(x):\n\treturn label_map[x]\ndf[\"label\"] = df[\"label\"].apply(replace_label) \ndf[\"text\"] = df[\"title\"] + \" \" + df[\"lead\"]\ndf.head()","output":{"0":{"data":{"text/html":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>label</th>\n      <th>title</th>\n      <th>lead</th>\n      <th>text</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>business</td>\n      <td>Carlyle Looks Toward Commercial Aerospace (Reu...</td>\n      <td>Reuters - Private investment firm Carlyle Grou...</td>\n      <td>Carlyle Looks Toward Commercial Aerospace (Reu...</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>business</td>\n      <td>Oil and Economy Cloud Stocks' Outlook (Reuters)</td>\n      <td>Reuters - Soaring crude prices plus worries\\ab...</td>\n      <td>Oil and Economy Cloud Stocks' Outlook (Reuters...</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>business</td>\n      <td>Iraq Halts Oil Exports from Main Southern Pipe...</td>\n      <td>Reuters - Authorities have halted oil export\\f...</td>\n      <td>Iraq Halts Oil Exports from Main Southern Pipe...</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>business</td>\n      <td>Oil prices soar to all-time record, posing new...</td>\n      <td>AFP - Tearaway world oil prices, toppling reco...</td>\n      <td>Oil prices soar to all-time record, posing new...</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>business</td>\n      <td>Stocks End Up, But Near Year Lows (Reuters)</td>\n      <td>Reuters - Stocks ended slightly higher on Frid...</td>\n      <td>Stocks End Up, But Near Year Lows (Reuters) Re...</td>\n    </tr>\n  </tbody>\n</table>\n</div>","text/plain":"      label                                              title  \\\n0  business  Carlyle Looks Toward Commercial Aerospace (Reu...   \n1  business    Oil and Economy Cloud Stocks' Outlook (Reuters)   \n2  business  Iraq Halts Oil Exports from Main Southern Pipe...   \n3  business  Oil prices soar to all-time record, posing new...   \n4  business        Stocks End Up, But Near Year Lows (Reuters)   \n\n                                                lead  \\\n0  Reuters - Private investment firm Carlyle Grou...   \n1  Reuters - Soaring crude prices plus worries\\ab...   \n2  Reuters - Authorities have halted oil export\\f...   \n3  AFP - Tearaway world oil prices, toppling reco...   \n4  Reuters - Stocks ended slightly higher on Frid...   \n\n                                                text  \n0  Carlyle Looks Toward Commercial Aerospace (Reu...  \n1  Oil and Economy Cloud Stocks' Outlook (Reuters...  \n2  Iraq Halts Oil Exports from Main Southern Pipe...  \n3  Oil prices soar to all-time record, posing new...  \n4  Stocks End Up, But Near Year Lows (Reuters) Re...  "},"exec_count":1,"output_type":"execute_result"}},"pos":3,"type":"cell"}
{"cell_type":"code","exec_count":10,"id":"d9f5bf","input":"##TODO train a LDA Mallet model with 5, 10 and 15 topics\n##TODO compute the coherence score for each of these model and print the number of topics from the model with highest coherence score\n#mallet_path = '/home/cmarangon/mallet-2.0.8/bin/mallet'\nmallet_path = 'mallet-2.0.8/bin/mallet'\n\nscores = []\nfor num_topics in [5, 10, 15]:\n    lda = LdaMallet(mallet_path, doc_term_matrix, num_topics=num_topics, id2word=dictionary)\n    coherence = CoherenceModel(model=lda, texts=dfs['tokens'], corpus=doc_term_matrix, dictionary=dictionary, coherence='c_v')\n    scores.append((num_topics, coherence.get_coherence()))\ndf_topic = pd.DataFrame(scores, columns=[\"Number of Topics\", \"Coherence Scores\"])\ndf_topic.head()","output":{"0":{"data":{"text/html":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Number of Topics</th>\n      <th>Coherence Scores</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>5</td>\n      <td>0.549539</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>10</td>\n      <td>0.569568</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>15</td>\n      <td>0.594188</td>\n    </tr>\n  </tbody>\n</table>\n</div>","text/plain":"   Number of Topics  Coherence Scores\n0                 5          0.549539\n1                10          0.569568\n2                15          0.594188"},"exec_count":10,"output_type":"execute_result"}},"pos":17,"type":"cell"}
{"cell_type":"code","exec_count":11,"id":"1bc8ba","input":"opt_topics = int(df_topic.iloc[df_topic['Coherence Scores'].idxmax()]['Number of Topics'])\nprint('The optimal number of topics is: %s' %opt_topics)","output":{"0":{"name":"stdout","output_type":"stream","text":"The optimal number of topics is: 15\n"}},"pos":18,"type":"cell"}
{"cell_type":"code","exec_count":12,"id":"c0ab63","input":"import pyLDAvis.gensim\nfrom gensim.models import wrappers\n\n##TODO using LDAvis visualize the topics using the optimal number of topics\n\nlda = LdaMallet(mallet_path, doc_term_matrix, num_topics=opt_topics, id2word=dictionary)\nlda_vis = wrappers.ldamallet.malletmodel2ldamodel(lda)\n\npyLDAvis.enable_notebook()\npyLDAvis.gensim.prepare(lda_vis, doc_term_matrix, dictionary)\n\n","output":{"0":{"more_output":true}},"pos":19,"type":"cell"}
{"cell_type":"code","exec_count":2,"id":"1c9de8","input":"import spacy\ndfs = df.sample(200)\nnlp = spacy.load('en_core_web_sm')\nfrom sklearn.feature_extraction.text import CountVectorizer\n\n##TODO pre-process text as you did in HW02\nimport spacy\nnlp = spacy.load('en_core_web_sm')\ndef tokenize(x):\n    return [w.lemma_.lower() for w in nlp(x) if not w.is_stop and not w.is_punct and not w.is_digit]\ndfs[\"tokens\"] = dfs[\"text\"].apply(lambda x: tokenize(x))\ndfs[\"preprocessed\"] = dfs['tokens'].apply(lambda x: ' '.join(x))\n##TODO vectorize the pre-processed text using CountVectorizer\nfrom sklearn.feature_extraction.text import CountVectorizer\nvec = CountVectorizer(min_df=0.01, # at min 1% of docs\n                        max_df=.9,  \n                        max_features=1000,\n                        stop_words='english',\n                        ngram_range=(1,3))\nX = vec.fit_transform(dfs['preprocessed']).toarray()","pos":4,"type":"cell"}
{"cell_type":"code","exec_count":3,"id":"ad9a15","input":"from sklearn.metrics.pairwise import cosine_similarity\nimport numpy as np\n\n##TODO compute the cosine similarity for the first 200 snippets and show the similatrity scores for the first document\nsim = cosine_similarity(X)\n\ntext1 = sim[0]\ntext1 = sorted(text1, reverse=True)\ndoc_num = int(np.where(sim[0]==text1[1])[0])\nprint(dfs.iloc[0]['text'])\nprint(' ')\nprint(dfs.iloc[doc_num]['text'])","output":{"0":{"name":"stdout","output_type":"stream","text":"U.S. Official: No Prospect of Bargain on Iran Nukes (Reuters) Reuters - The United States sees no reason to\\offer Iran incentives to ensure its nuclear program remains\\peaceful, a U.S. government official said on Tuesday.\n \nSaddam Told Interrogators of Iran Fixation WASHINGTON - Saddam Hussein was obsessed with his status in the Arab world, dreaming of weapons of mass destruction to pump up his prestige. And even as the United States fixated on him, he was fixated on his neighboring enemy, Iran...\n"}},"pos":6,"type":"cell"}
{"cell_type":"code","exec_count":4,"id":"b8efb2","input":"from sklearn.decomposition import PCA\npca = PCA(n_components=3,svd_solver='randomized')\n\n##TODO reduce the data using PCA\nXpca = pca.fit_transform(X)\n\n##TODO compute the cosine similarity with the reduced data\nsim_pca = cosine_similarity(Xpca)\n\nsim[0][:10], sim_pca[0][:10]","output":{"0":{"data":{"text/plain":"(array([1.        , 0.05897678, 0.04364358, 0.        , 0.        ,\n        0.        , 0.17457431, 0.        , 0.        , 0.11094004]),\n array([ 1.        , -0.6535737 ,  0.57312749, -0.55511102,  0.34821877,\n         0.39366938,  0.6147464 ,  0.34145716, -0.91711227,  0.63979268]))"},"exec_count":4,"output_type":"execute_result"}},"pos":7,"type":"cell"}
{"cell_type":"code","exec_count":5,"id":"0e09c2","input":"text1 = sim_pca[0]\ntext1 = sorted(text1, reverse=True)\ndoc_num = int(np.where(sim_pca[0]==text1[1])[0])\nprint(dfs.iloc[0]['text'])\nprint(' ')\nprint(dfs.iloc[doc_num]['text'])","output":{"0":{"name":"stdout","output_type":"stream","text":"U.S. Official: No Prospect of Bargain on Iran Nukes (Reuters) Reuters - The United States sees no reason to\\offer Iran incentives to ensure its nuclear program remains\\peaceful, a U.S. government official said on Tuesday.\n \nDisaster Toll Tripled in 2003 Amid Quakes, Heatwave (Reuters) Reuters - Natural disasters killed 76,806 people\\in 2003, three times the number of victims in 2002, a rise due\\in part to extremes in the global climate, the world's largest\\humanitarian body said on Thursday.\n"}},"pos":8,"type":"cell"}
{"cell_type":"code","exec_count":6,"id":"b6b4ca","input":"from sklearn.cluster import KMeans\nfrom sklearn.metrics import silhouette_score\n\n##TODO create the clusters found with k-means clustering and 10 clusters\nkm = KMeans(n_clusters=10)\nkm.fit(X)\ndoc_clusters = km.labels_.tolist()\ndfs['cluster'] = doc_clusters\ndfs[dfs['cluster']==1][['label','text']]","output":{"0":{"data":{"text/html":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>label</th>\n      <th>text</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>69444</th>\n      <td>sport</td>\n      <td>This Date in Baseball for Oct. 23 (AP) AP - 19...</td>\n    </tr>\n    <tr>\n      <th>49655</th>\n      <td>sport</td>\n      <td>Healthy Iverson Vows Changes This Season (AP) ...</td>\n    </tr>\n    <tr>\n      <th>72866</th>\n      <td>world</td>\n      <td>Svenska Cellulosa to Slash 1,200 Jobs (AP) AP ...</td>\n    </tr>\n    <tr>\n      <th>5220</th>\n      <td>sport</td>\n      <td>Golfer Thatcher Leads at Reno-Tahoe Open (AP) ...</td>\n    </tr>\n    <tr>\n      <th>111633</th>\n      <td>sport</td>\n      <td>Eagles' Westbrook Turning Into Elite Back (AP)...</td>\n    </tr>\n    <tr>\n      <th>49958</th>\n      <td>world</td>\n      <td>Supreme Court OKs Calif. Gun Show Bans (AP) AP...</td>\n    </tr>\n    <tr>\n      <th>98144</th>\n      <td>sport</td>\n      <td>Injuries Deplete Rams Defensive Secondary (AP)...</td>\n    </tr>\n    <tr>\n      <th>102727</th>\n      <td>sport</td>\n      <td>Chargers Confident Going Into Jets Rematch (AP...</td>\n    </tr>\n    <tr>\n      <th>102872</th>\n      <td>world</td>\n      <td>Poll: Blair Retains Electoral Lead (AP) AP - P...</td>\n    </tr>\n    <tr>\n      <th>64856</th>\n      <td>world</td>\n      <td>Israel, Egypt Move Toward Warm Relations (AP) ...</td>\n    </tr>\n    <tr>\n      <th>47705</th>\n      <td>sport</td>\n      <td>Braves' Thomson, Chipper Jones Hurt (AP) AP - ...</td>\n    </tr>\n    <tr>\n      <th>99443</th>\n      <td>sport</td>\n      <td>Sportsview: Gap Between NBA Players, Fans (AP)...</td>\n    </tr>\n    <tr>\n      <th>37381</th>\n      <td>sci/tech</td>\n      <td>Scientists Seek Limit on Shark Killings (AP) A...</td>\n    </tr>\n    <tr>\n      <th>68161</th>\n      <td>sci/tech</td>\n      <td>U.N. Divided Over Anti-Cloning Treaty (AP) AP ...</td>\n    </tr>\n    <tr>\n      <th>57355</th>\n      <td>sport</td>\n      <td>Dolphins May Turn to Third-String QB (AP) AP -...</td>\n    </tr>\n  </tbody>\n</table>\n</div>","text/plain":"           label                                               text\n69444      sport  This Date in Baseball for Oct. 23 (AP) AP - 19...\n49655      sport  Healthy Iverson Vows Changes This Season (AP) ...\n72866      world  Svenska Cellulosa to Slash 1,200 Jobs (AP) AP ...\n5220       sport  Golfer Thatcher Leads at Reno-Tahoe Open (AP) ...\n111633     sport  Eagles' Westbrook Turning Into Elite Back (AP)...\n49958      world  Supreme Court OKs Calif. Gun Show Bans (AP) AP...\n98144      sport  Injuries Deplete Rams Defensive Secondary (AP)...\n102727     sport  Chargers Confident Going Into Jets Rematch (AP...\n102872     world  Poll: Blair Retains Electoral Lead (AP) AP - P...\n64856      world  Israel, Egypt Move Toward Warm Relations (AP) ...\n47705      sport  Braves' Thomson, Chipper Jones Hurt (AP) AP - ...\n99443      sport  Sportsview: Gap Between NBA Players, Fans (AP)...\n37381   sci/tech  Scientists Seek Limit on Shark Killings (AP) A...\n68161   sci/tech  U.N. Divided Over Anti-Cloning Treaty (AP) AP ...\n57355      sport  Dolphins May Turn to Third-String QB (AP) AP -..."},"exec_count":6,"output_type":"execute_result"}},"pos":11,"type":"cell"}
{"cell_type":"code","exec_count":7,"id":"ae094b","input":"##TODO find the optimal number of clusters in a range from 2 to 50 using the silhouette score\n\nsil_scores = []\nfor n in range(2, 50):\n    km = KMeans(n_clusters=n)\n    km.fit(X)\n    sil_scores.append(silhouette_score(X, km.labels_))\n\nimport matplotlib.pyplot as plt \nplt.plot(range(2, 50), sil_scores)\nplt.xlabel('Number of Clusters')\nplt.ylabel('Silhouette Score')\nplt.show()\n\nopt_sil_score = max(sil_scores[2:])\nsil_scores.index(opt_sil_score)\nopt_num_cluster = range(2, 50)[sil_scores.index(opt_sil_score)]\nprint('The optimal number of clusters is %s' %opt_num_cluster)","output":{"0":{"data":{"image/png":"94b988234cd1bfc5463577e47c4b95e98fca0ae2","text/plain":"<Figure size 432x288 with 1 Axes>"},"metadata":{"needs_background":"light"},"output_type":"display_data"},"1":{"name":"stdout","output_type":"stream","text":"The optimal number of clusters is 4\n"}},"pos":12,"type":"cell"}
{"cell_type":"code","exec_count":8,"id":"91b95f","input":"##TODO create the clusters using the opitmal number of clusters obtained before\n##TODO compare the documents in cluster 1 under the two specifications\nkm = KMeans(n_clusters=opt_num_cluster)\nkm.fit(X)\ndoc_clusters = km.labels_.tolist()\n\ndfs['cluster_opt'] = doc_clusters\ndfs[dfs['cluster_opt']==1][['label','text']]\n","output":{"0":{"data":{"text/html":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>label</th>\n      <th>text</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>5020</th>\n      <td>world</td>\n      <td>Stocks Up Despite Oil Nearing \\$50 a Barrel NE...</td>\n    </tr>\n    <tr>\n      <th>90253</th>\n      <td>sport</td>\n      <td>Aggies won't be outgunned COLLEGE STATION, Tex...</td>\n    </tr>\n    <tr>\n      <th>54080</th>\n      <td>business</td>\n      <td>Melnyk steps aside at Biovail Billionaire Euge...</td>\n    </tr>\n    <tr>\n      <th>63997</th>\n      <td>business</td>\n      <td>Oil Prices Slide After Posting New High Oil pr...</td>\n    </tr>\n    <tr>\n      <th>64019</th>\n      <td>business</td>\n      <td>Marsh  amp; McLennan plummets as market run sc...</td>\n    </tr>\n    <tr>\n      <th>94403</th>\n      <td>business</td>\n      <td>Column: Cheaper Oil Fuels Stocks Rally  NEW YO...</td>\n    </tr>\n  </tbody>\n</table>\n</div>","text/plain":"          label                                               text\n5020      world  Stocks Up Despite Oil Nearing \\$50 a Barrel NE...\n90253     sport  Aggies won't be outgunned COLLEGE STATION, Tex...\n54080  business  Melnyk steps aside at Biovail Billionaire Euge...\n63997  business  Oil Prices Slide After Posting New High Oil pr...\n64019  business  Marsh  amp; McLennan plummets as market run sc...\n94403  business  Column: Cheaper Oil Fuels Stocks Rally  NEW YO..."},"exec_count":8,"output_type":"execute_result"}},"pos":13,"type":"cell"}
{"cell_type":"code","exec_count":9,"id":"ae0e16","input":"from gensim.corpora import Dictionary\nfrom gensim.models.wrappers import LdaMallet\nfrom gensim.models.coherencemodel import CoherenceModel\n\n##TODO create a dictionary with the pre-processed tokenized text and filter it according to frequencies and keeping 1000 vocabularies\nfrom gensim import corpora\ndictionary = corpora.Dictionary(dfs['tokens'])\nprint (len(dictionary))\n##TODO create the doc_term_matrix\ndoc_term_matrix = [dictionary.doc2bow(doc) for doc in dfs['tokens']]","output":{"0":{"name":"stdout","output_type":"stream","text":"2394\n"}},"pos":16,"type":"cell"}
{"cell_type":"code","id":"65b39d","input":"","pos":20,"type":"cell"}
{"cell_type":"markdown","id":"05cf3d","input":"Compare the cosine similarity before and after PCA reduction. Did the results change? ","pos":9,"type":"cell"}
{"cell_type":"markdown","id":"4ce524","input":"# HW03: Distance and Topic Model","pos":0,"type":"cell"}
{"cell_type":"markdown","id":"6f6540","input":"## Load and Pre-process Text","pos":2,"type":"cell"}
{"cell_type":"markdown","id":"78fbac","input":"## Topic Modeling: LDA","pos":14,"type":"cell"}
{"cell_type":"markdown","id":"9937c5","input":"For this part you will need to use LDA Mallet. If you cannot have Mallet run, you can use the simple LDA algorithm ","pos":15,"type":"cell"}
{"cell_type":"markdown","id":"b002c5","input":"## Clustering","pos":10,"type":"cell"}
{"cell_type":"markdown","id":"d3c718","input":"Remember that these homework work as a completion grade. **You can skip one section without losing credit.**","pos":1,"type":"cell"}
{"cell_type":"markdown","id":"e05c82","input":"## Cosine Similarity and PCA","pos":5,"type":"cell"}
{"id":0,"time":1620468367789,"type":"user"}
{"last_load":1620468368203,"type":"file"}